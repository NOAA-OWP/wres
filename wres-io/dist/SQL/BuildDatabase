#!/bin/bash

if [ $# -eq 0 ]; then
    echo 'usage: ./BuildDatabase <IOEP Database username> <host> <database name>'
else
    echo 'Droping old tables and data...'
    psql -U $1 -d $3 -h $2 -f DropTables.sql >/dev/null

    echo ''
    echo 'Adding wres.MeasurementUnit...'
    psql -U $1 -d $3 -h $2 -f wres.MeasurementUnit.sql >/dev/null

    echo ''
    echo 'Adding wres.Variable...'
    psql -U $1 -d $3 -h $2 -f wres.Variable.sql >/dev/null

    echo ''
    echo 'Adding wres.Scenario...'
    psql -U $1 -d $3 -h $2 -f wres.Scenario.sql >/dev/null

    echo ''
    echo 'Adding wres.Source...'
    psql -U $1 -d $3 -h $2 -f wres.Source.sql >/dev/null

    echo ''
    echo 'Adding wres.Forecast...'
    psql -U $1 -d $3 -h $2 -f wres.Forecast.sql >/dev/null

    echo ''
    echo 'Adding wres.VariablePosition...'
    psql -U $1 -d $3 -h $2 -f wres.VariablePosition.sql >/dev/null

    echo ''
    echo 'Adding wres.Ensemble...'
    psql -U $1 -d $3 -h $2 -f wres.Ensemble.sql >/dev/null

    echo ''
    echo 'Adding wres.ForecastEnsemble...'
    psql -U $1 -d $3 -h $2 -f wres.ForecastEnsemble.sql >/dev/null

    echo ''
    echo 'Adding wres.Observation...'
    psql -U $1 -d $3 -h $2 -f wres.Observation.sql >/dev/null

    echo ''
    echo 'Adding wres.UnitConversion.sql...'
    psql -U $1 -d $3 -h $2 -f wres.UnitConversion.sql >/dev/null

    echo ''
    echo 'Adding wres.Feature...'
    psql -U $1 -d $3 -h $2 -f wres.Feature.sql >/dev/null

    echo ''
    echo 'Adding values to wres.Feature...'
    psql -U $1 -d $3 -h $2 -f Features.sql >/dev/null

    echo ''
    echo 'Adding wres.FeaturePosition...'
    psql -U $1 -d $3 -h $2 -f wres.FeaturePosition.sql >/dev/null

    echo ''
    echo 'Adding wres.ForecastValue...'
    psql -U $1 -d $3 -h $2 -f wres.ForecastValue.sql >/dev/null

    echo ''
    echo 'Adding get_variableposition_id function...'
    psql -U $1 -d $3 -h $2 -f get_variableposition_id.sql >/dev/null

    echo ''
    echo 'Adding wres.NetCDFCoordinate...'
    psql -U $1 -d $3 -h $2 -f wres.NetCDFCoordinate.sql >/dev/null

    echo ''
    echo 'Adding wres.NetCDFFeature...'
    psql -U $1 -d $3 -h $2 -f wres.NetCDFFeature.sql >/dev/null

    echo ''
    echo 'Adding add_netcdffeature function...'
    psql -U $1 -d $3 -h $2 -f wres.add_netcdffeature.sql >/dev/null

    echo ''
    echo 'Adding wres.ForecastSource...'
    psql -U $1 -d $3 -h $2 -f wres.ForecastSource.sql >/dev/null

    echo ''
    echo 'Adding the execution log...'
    psql -U $1 -d $3 -h $2 -f executionlog.sql >/dev/null

    echo ''
    echo 'Adding the Index Queue...'
    psql -U $1 -d $3 -h $2 -f IndexQueue.sql >/dev/null

    echo ''
    echo 'Creating the schema for dynamically generated partitions...'
    psql -U $1 -d $3 -h $2 -c "CREATE SCHEMA IF NOT EXISTS partitions AUTHORIZATION wres;" >/dev/null
fi
