#!/bin/bash

if [ $# -eq 0 ]; then
    echo 'usage: ./BuildDatabase <Database username> <host> <database name>'
else
    echo 'Droping old tables and data...'
    psql -U $1 -d $3 -h $2 -f DropTables.sql >/dev/null

    echo ''
    echo 'Adding wres.MeasurementUnit...'
    psql -U $1 -d $3 -h $2 -f wres.MeasurementUnit.sql >/dev/null

    echo ''
    echo 'Adding wres.Variable...'
    psql -U $1 -d $3 -h $2 -f wres.Variable.sql >/dev/null

    echo ''
    echo 'Adding wres.Source...'
    psql -U $1 -d $3 -h $2 -f wres.Source.sql >/dev/null

    echo ''
    echo 'Adding wres.Project...'
    psql -U $1 -d $3 -h $2 -f wres.Project.sql >/dev/null

    echo ''
    echo 'Adding operating_member...'
    psql -U $1 -d $3 -h $2 -f operating_member.sql >/dev/null

    echo ''
    echo 'Adding wres.ProjectSource...'
    psql -U $1 -d $3 -h $2 -f wres.ProjectSource.sql >/dev/null

    echo ''
    echo 'Adding wres.VariablePosition...'
    psql -U $1 -d $3 -h $2 -f wres.VariablePosition.sql >/dev/null

    echo ''
    echo 'Adding wres.Ensemble...'
    psql -U $1 -d $3 -h $2 -f wres.Ensemble.sql >/dev/null

    echo ''
    echo 'Adding wres.TimeSeries...'
    psql -U $1 -d $3 -h $2 -f wres.TimeSeries.sql >/dev/null

    echo ''
    echo 'Adding wres.Observation...'
    psql -U $1 -d $3 -h $2 -f wres.Observation.sql >/dev/null

    echo ''
    echo 'Adding wres.UnitConversion.sql...'
    psql -U $1 -d $3 -h $2 -f wres.UnitConversion.sql >/dev/null

    echo ''
    echo 'Adding wres.Feature...'
    psql -U $1 -d $3 -h $2 -f wres.Feature.sql >/dev/null

    echo ''
    echo 'Adding values to wres.Feature...'
    psql -U $1 -d $3 -h $2 -f Features.sql >/dev/null

    echo ''
    echo 'Adding wres.ForecastValue...'
    psql -U $1 -d $3 -h $2 -f wres.ForecastValue.sql >/dev/null

    echo ''
    echo 'Adding get_variableposition_id function...'
    psql -U $1 -d $3 -h $2 -f get_variableposition_id.sql >/dev/null

    echo ''
    echo 'Adding wres.GridProjection...'
    psql -U $1 -d $3 -h $2 -f wres.GridProjection.sql >/dev/null

    echo ''
    echo 'Adding wres.NetCDFCoordinate...'
    psql -U $1 -d $3 -h $2 -f wres.NetCDFCoordinate.sql >/dev/null

    echo ''
    echo 'Adding wres.NetCDFFeature...'
    psql -U $1 -d $3 -h $2 -f wres.NetCDFFeature.sql >/dev/null

    echo ''
    echo 'Adding add_netcdffeature function...'
    psql -U $1 -d $3 -h $2 -f wres.add_netcdffeature.sql >/dev/null

    echo ''
    echo 'Adding wres.ForecastSource...'
    psql -U $1 -d $3 -h $2 -f wres.ForecastSource.sql >/dev/null

    echo ''
    echo 'Adding the execution log...'
    psql -U $1 -d $3 -h $2 -f executionlog.sql >/dev/null

    echo ''
    echo 'Adding the Index Queue...'
    psql -U $1 -d $3 -h $2 -f IndexQueue.sql >/dev/null

    echo ''
    echo 'Adding wres.USGSParameter...'
    psql -U $1 -d $3 -h $2 -f wres.USGSParameter.sql >/dev/null

    echo ''
    echo 'Adding the wres.VariableByFeature view...'
    psql -U $1 -d $3 -h $2 -f wres.VariableByFeature.sql >/dev/null

    echo ''
    echo 'Adding the wres.forecasts view...'
    psql -U $1 -d $3 -h $2 -f wres.forecasts.sql >/dev/null

    echo ''
    echo 'Adding the wres.Conversions view...'
    psql -U $1 -d $3 -h $2 -f wres.Conversions.sql >/dev/null

    echo ''
    echo 'Adding the public.ProjectExecutions view...'
    psql -U $1 -d $3 -h $2 -f ProjectExecutions.sql >/dev/null

    echo ''
    echo 'Creating the schema for dynamically generated partitions...'
    psql -U $1 -d $3 -h $2 -c "CREATE SCHEMA IF NOT EXISTS partitions AUTHORIZATION wres;" >/dev/null
fi
